# UG ç®¡ç†ç³»ç»Ÿ

åŸºäº UMI + Egg.js çš„ç°ä»£åŒ–ç®¡ç†ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†ã€åŠ¨æ€è¡¨æ ¼è¡¨å•ç­‰åŠŸèƒ½ã€‚

## é¡¹ç›®çŠ¶æ€

ğŸ‰ **100% å®Œæˆ** - é¡¹ç›®å·²å®Œå…¨å¼€å‘å®Œæˆï¼ŒåŒ…å«å®Œæ•´çš„å‰åç«¯åŠŸèƒ½ï¼Œå¯ç›´æ¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨ã€‚

## é¡¹ç›®ç»“æ„

```
UG/
â”œâ”€â”€ frontend/           # å‰ç«¯é¡¹ç›® (UMI + React)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/ # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layouts/    # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ models/     # UMI æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ pages/      # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/   # API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ utils/      # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ wrappers/   # è·¯ç”±åŒ…è£…å™¨
â”‚   â”‚   â””â”€â”€ styles/     # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ public/         # é™æ€èµ„æº
â”‚   â””â”€â”€ config/         # UMI é…ç½®
â”œâ”€â”€ backend/            # åç«¯é¡¹ç›® (Egg.js)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ controller/ # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ service/    # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ middleware/ # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ model/      # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ extend/     # æ‰©å±•
â”‚   â”œâ”€â”€ config/         # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“è¿ç§»å’Œç§å­
â”‚   â”œâ”€â”€ test/           # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ logs/           # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ docs/               # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/            # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ tools/              # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ check-environment.js    # ç¯å¢ƒæ£€æµ‹å·¥å…·
â”‚   â”œâ”€â”€ check-environment.bat   # ç¯å¢ƒæ£€æµ‹è„šæœ¬
â”‚   â”œâ”€â”€ start-with-check.bat    # å¸¦æ£€æµ‹çš„å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start-all.bat           # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start-backend.bat       # å¯åŠ¨åç«¯è„šæœ¬
â”‚   â””â”€â”€ start-frontend.bat      # å¯åŠ¨å‰ç«¯è„šæœ¬
â”œâ”€â”€ .vscode/            # VSCode é…ç½®
â”œâ”€â”€ tsconfig.json       # TypeScript é…ç½®
â”œâ”€â”€ typings.d.ts        # ç±»å‹å£°æ˜
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## æŠ€æœ¯æ ˆ

### å‰ç«¯

- **æ¡†æ¶**: UMI 4.x + React 18 + TypeScript 5.x
- **UI åº“**: Ant Design 5.x
- **çŠ¶æ€ç®¡ç†**: UMI Model
- **ç½‘ç»œè¯·æ±‚**: umi-request
- **å·¥å…·åº“**: ahooks, dayjs, lodash
- **å›¾è¡¨åº“**: ECharts
- **æ ·å¼**: Less + CSS Modules

### åç«¯

- **æ¡†æ¶**: Egg.js 3.x + Node.js 16+
- **æ•°æ®åº“**: MySQL 8.0 + Sequelize ORM
- **è®¤è¯**: JWT (jsonwebtoken) + Refresh Token
- **åŠ å¯†**: bcryptjs
- **æ ¡éªŒ**: Joi
- **æ—¥å¿—**: egg-logger

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ” RBAC æƒé™ç®¡ç†ç³»ç»Ÿ

- **ä¸‰çº§æƒé™æ§åˆ¶**: èœå•æƒé™ + æŒ‰é’®æƒé™ + API æƒé™
- **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç®¡ç†ã€æ‰¹é‡æ“ä½œã€å¯†ç é‡ç½®
- **è§’è‰²ç®¡ç†**: è§’è‰²é…ç½®ã€æƒé™åˆ†é…ã€ç”¨æˆ·å…³è”
- **æƒé™ç®¡ç†**: æ ‘å½¢ç»“æ„ã€åŠ¨æ€èœå•ã€æƒé™éªŒè¯

### ğŸ¨ å“åº”å¼å‰ç«¯ç•Œé¢

- **åŠ¨æ€ç»„ä»¶**: é…ç½®åŒ–è¡¨æ ¼ã€è¡¨å•ã€CRUD ç»„ä»¶
- **ä¸»é¢˜ç³»ç»Ÿ**: äº®è‰²/æš—è‰²ä¸»é¢˜åˆ‡æ¢
- **è·¯ç”±ç³»ç»Ÿ**: æƒé™è·¯ç”±ã€é¢åŒ…å±‘å¯¼èˆª
- **çŠ¶æ€ç®¡ç†**: UMI Model + æ•°æ®ç¼“å­˜

### ğŸ“Š å®Œæ•´çš„ä¸šåŠ¡é¡µé¢

- **ä»ªè¡¨ç›˜**: æ•°æ®ç»Ÿè®¡ã€å›¾è¡¨å±•ç¤ºã€ç³»ç»Ÿå¥åº·ç›‘æ§
- **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·åˆ—è¡¨ã€æ–°å¢ç¼–è¾‘ã€çŠ¶æ€ç®¡ç†ã€æ‰¹é‡æ“ä½œ
- **è§’è‰²ç®¡ç†**: è§’è‰²é…ç½®ã€æƒé™è®¾ç½®ã€ç”¨æˆ·åˆ†é…
- **æƒé™ç®¡ç†**: æƒé™æ ‘ç®¡ç†ã€ç±»å‹åˆ†ç±»ã€çŠ¶æ€æ§åˆ¶
- **ä¸ªäººä¸­å¿ƒ**: ä¸ªäººä¿¡æ¯ã€å¤´åƒä¸Šä¼ ã€å¯†ç ä¿®æ”¹ã€ç™»å½•å†å²

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 20.14.0
- MySQL >= 8.0
- npm >= 7.0.0

### å®‰è£…å’Œå¯åŠ¨

1. **å…‹éš†é¡¹ç›®**

```bash
git clone <repository-url>
cd UG
```

2. **åç«¯è®¾ç½®**

```bash
cd backend
npm install
# é…ç½®æ•°æ®åº“è¿æ¥
mysql -u root -p
CREATE DATABASE ug_project DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci;
# è¿è¡Œæ•°æ®åº“è¿ç§»
npx sequelize-cli db:migrate
npx sequelize-cli db:seed:all
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

3. **å‰ç«¯è®¾ç½®**

```bash
cd frontend
npm install
npm start
```

## ç¨‹åºå¯åŠ¨æ£€æµ‹

ä¸ºäº†ç¡®ä¿é¡¹ç›®èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ï¼Œæˆ‘ä»¬æä¾›äº†ç¯å¢ƒæ£€æµ‹å·¥å…·æ¥æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒå’Œä¾èµ–é¡¹ã€‚

### ä½¿ç”¨æ–¹æ³•

1. **è¿è¡Œç¯å¢ƒæ£€æµ‹å·¥å…·**ï¼š

```bash
# Windows (CMD)
tools\check-environment.bat

# è·¨å¹³å°ï¼ˆéœ€è¦ Node.jsï¼‰
node tools/check-environment.js
```

2. **è¿è¡Œå¸¦æ£€æµ‹çš„å¯åŠ¨è„šæœ¬**ï¼š

```bash
# Windows (CMD)
tools\start-with-check.bat
```

æ£€æµ‹å·¥å…·ä¼šæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- Node.js å’Œ npm ç‰ˆæœ¬
- é¡¹ç›®ä¾èµ–æ–‡ä»¶ (package.json) æ˜¯å¦å­˜åœ¨
- æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
- ç«¯å£å ç”¨æƒ…å†µ
- å¿…éœ€çš„ç¯å¢ƒå˜é‡

## Node.js ç‰ˆæœ¬é™åˆ¶

ä¸ºäº†ç¡®ä¿é¡¹ç›®åœ¨æ‰€æœ‰ç¯å¢ƒä¸­çš„å…¼å®¹æ€§å’Œä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å·²å°† Node.js ç‰ˆæœ¬ä¸¥æ ¼é™åˆ¶ä¸º `20.14.0`ï¼š

- **å‰ç«¯é¡¹ç›®**: `frontend/package.json` ä¸­çš„ `engines.node`
- **åç«¯é¡¹ç›®**: `backend/package.json` ä¸­çš„ `engines.node`
- **æ ¹é¡¹ç›®**: `package.json` ä¸­çš„ `engines.node`

é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ [.nvmrc](file:///e:/YSY/UG/.nvmrc) æ–‡ä»¶ä¹Ÿå·²è®¾ç½®ä¸º `20.14.0`ï¼Œæ–¹ä¾¿ä½¿ç”¨ nvm ç®¡ç† Node.js ç‰ˆæœ¬ã€‚

å¦‚æœä½¿ç”¨ nvmï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°æŒ‡å®šç‰ˆæœ¬ï¼š

```bash
nvm install 20.14.0
nvm use 20.14.0
```

## TypeScript é…ç½®æ›´æ–°

ä¸ºäº†è§£å†³ TypeScript 7.0 ä¸­å°†ç§»é™¤ `moduleResolution=node10` é€‰é¡¹çš„å¼ƒç”¨è­¦å‘Šï¼Œæˆ‘ä»¬å·²æ›´æ–°æ‰€æœ‰é¡¹ç›®çš„ TypeScript é…ç½®ï¼š

- **æ ¹ç›®å½•**: [tsconfig.json](file:///e:/YSY/UG/tsconfig.json) ä¸­çš„ `ignoreDeprecations` è®¾ç½®ä¸º `"6.0"`
- **å‰ç«¯é¡¹ç›®**: [frontend/tsconfig.json](file:///e:/YSY/UG/frontend/tsconfig.json) ä¸­çš„ `ignoreDeprecations` è®¾ç½®ä¸º `"6.0"`
- **åç«¯é¡¹ç›®**: [backend/tsconfig.json](file:///e:/YSY/UG/backend/tsconfig.json) ä¸­çš„ `ignoreDeprecations` è®¾ç½®ä¸º `"6.0"`

è¿™äº›é…ç½®ç¡®ä¿é¡¹ç›®èƒ½å¤Ÿå…¼å®¹æœªæ¥ç‰ˆæœ¬çš„ TypeScriptï¼ŒåŒæ—¶æ¶ˆé™¤äº†å¼ƒç”¨è­¦å‘Šã€‚

## TypeScript ç‰ˆæœ¬ç»Ÿä¸€

ä¸ºäº†ç¡®ä¿é¡¹ç›®çš„ä¸€è‡´æ€§å’Œå…¼å®¹æ€§ï¼Œæˆ‘ä»¬å·²å°†æ‰€æœ‰å­é¡¹ç›®çš„ TypeScript ç‰ˆæœ¬ç»Ÿä¸€ä¸º `^5.9.2`ï¼š

- **å‰ç«¯é¡¹ç›®**: [frontend/package.json](file:///e:/YSY/UG/frontend/package.json) ä¸­çš„ `devDependencies.typescript`
- **åç«¯é¡¹ç›®**: [backend/package.json](file:///e:/YSY/UG/backend/package.json) ä¸­çš„ `devDependencies.typescript`
- **æ ¹é¡¹ç›®**: [package.json](file:///e:/YSY/UG/package.json) ä¸­çš„ `devDependencies.typescript`

å¦‚æœéœ€è¦æ›´æ–° TypeScript ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨é¡¹ç›®ä¸­çš„ç»Ÿä¸€æ›´æ–°è„šæœ¬ï¼š

```bash
# Windows
scripts\update-typescript-version.bat

# macOS/Linux
scripts/update-typescript-version.sh
```

## Git è‡ªåŠ¨å¤‡ä»½å’Œæ›´æ–°

ä¸ºäº†è§£å†³ Git ä¸èƒ½è‡ªåŠ¨å¤‡ä»½å’Œæ›´æ–°çš„é—®é¢˜ï¼Œé¡¹ç›®æä¾›äº†è‡ªåŠ¨å¤‡ä»½å’Œæ›´æ–°è„šæœ¬ï¼š

### ä½¿ç”¨æ–¹æ³•

1. **é…ç½®è¿œç¨‹ä»“åº“**ï¼ˆå¦‚æœå°šæœªé…ç½®ï¼‰ï¼š

```bash
git remote add origin <ä½ çš„ä»“åº“åœ°å€>
```

2. **è¿è¡Œè‡ªåŠ¨å¤‡ä»½è„šæœ¬**ï¼š

```bash
# Windows
scripts\git-auto-backup.bat

# macOS/Linux
scripts/git-auto-backup.sh

# è·¨å¹³å°ï¼ˆéœ€è¦ Node.jsï¼‰
node scripts/git-auto-backup.js
```

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ›´æ”¹
- è‡ªåŠ¨æäº¤æ‰€æœ‰æ›´æ”¹
- æ‹‰å–è¿œç¨‹æ›´æ–°
- æ¨é€æœ¬åœ°æ›´æ”¹åˆ°è¿œç¨‹ä»“åº“

### å®šæ—¶è‡ªåŠ¨å¤‡ä»½

ä½ ä¹Ÿå¯ä»¥è®¾ç½®å®šæ—¶ä»»åŠ¡æ¥è‡ªåŠ¨æ‰§è¡Œå¤‡ä»½ï¼š

**Windows ä»»åŠ¡è®¡åˆ’ç¨‹åº**ï¼š

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è®¾ç½®è§¦å‘å™¨ï¼ˆå¦‚æ¯å¤©ã€æ¯å°æ—¶ç­‰ï¼‰
4. è®¾ç½®æ“ä½œä¸ºè¿è¡Œ [scripts\git-auto-backup.bat](file:///e:/YSY/UG/scripts/git-auto-backup.bat)

**Linux/macOS Cron**ï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆä¾‹å¦‚æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
0 * * * * cd /path/to/your/project && node scripts/git-auto-backup.js
```
